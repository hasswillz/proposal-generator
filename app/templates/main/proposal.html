<!--app/templates/main/proposal.html-->
{% extends "main/base.html" %}

{% block title %}{{ proposal.title }} - AI Proposal{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 text-white">{{ proposal.title }}</h4>

                    <div class="btn-group" role="group" aria-label="Download options">
                        <button type="button" class="btn btn-light btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            {{_("Download")}} <i class="bi bi-download"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{{ url_for('main.download_proposal', proposal_id=proposal.id, format='pdf') }}">PDF</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.download_proposal', proposal_id=proposal.id, format='docx') }}">DOCX</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <small class="text-muted d-block mb-3">Generated by {{ proposal.author.username }} on {{ moment(proposal.generated_at).format('YYYY-MM-DD HH:mm') }}</small>
                    <div class="proposal-content">
                               {% filter markdown %} {{ proposal.content }} {% endfilter %}
                        {# Render Markdown content. You might need a Markdown-to-HTML filter or library here #}
                        {# For simplicity, we'll just display it as raw text, assuming the AI generates HTML-safe markdown #}
                        {# In a real app, you'd use something like 'markdown' or 'markdown2' library to convert server-side #}
                        {# Or a client-side Markdown renderer #}
                        {{ proposal.content | safe }} {# Using safe filter, but be cautious with untrusted content #}
                    </div>
                </div>
                <div class="card-footer text-end">
                    <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary btn-sm">{{_("Back to Dashboard")}}</a>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}